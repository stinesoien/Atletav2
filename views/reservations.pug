html
    head
        link(rel='stylesheet', href='/stylesheets/myReservations.css')
        script(type="text/javascript", src="js/jquery-3.2.1.js")
        script(type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js")
    body
        include ./fixed/header.pug

        .myReservations

            .container#reservations
                pre#oneReservation

        script.
            var month = Date.today().toString("MM");
            var day = Date.today().toString("dd");
            var year = Date.today().toString("yyyy");

            var todaysDate = day+month+year;
            var intDate = parseInt(todaysDate);

            var thisReservation = document.getElementById("reservation")

            var getReservations = function () {
                $.ajax({
                    url: 'myReservations/',
                    type: 'GET'
                }).done(function (data) {
                    document.getElementById("oneReservation").innerHTML = ' ';
                    for (var i = 0; i < data.length; i++) {
                        var daySql = data[i].sqlDay;
                        var monthSql = data[i].sqlMonth;
                        var yearSql = data[i].sqlYear;
                        var currentDate= daySql+monthSql+yearSql;
                        var intCurrentDate = parseInt(currentDate);

                        if(intCurrentDate>= intDate){
                            thisReservation = data[i].b_id;
                            document.getElementById("oneReservation").innerHTML += '<div id="reservation">' + JSON.stringify("        " + data[i].b_name + "          " + data[i].time + "         " + data[i].dateFormat).replace(/\"/g, "")
                                + '<button type="button" id="deleteReservation" onclick="deleteReservations(this)" data-id=' + thisReservation + '>Avbestill time</button>' + '</div>';
                        }
                    }
                })
            };

            var deleteReservations = function(e){
                var test = $(e).data("id");
                $.ajax({
                    url: 'deleteReservation/',
                    type: 'DELETE',
                    data: {
                        'b_id': test
                    }
                }).done(function(){
                    getReservations();
                })

            }

            getReservations();
            deleteReservations(thisReservation);

        include ./fixed/footer.pug
